<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peg-in/Peg-out - Fleet Credits Developer Documentation</title>
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="docs-container">
        <!-- Sidebar Navigation -->
<aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">üöÄ</span>
                    <span class="logo-text">Fleet Credits</span>
                </div>
                <div class="version">v1.0.0 - Core</div>
                <div class="tagline">Scrypt PoW Blockchain with Contribution Rewards & MWEB Privacy</div>
                <div class="subtagline">‚ú® Complete Developer Documentation</div>
            </div>

            <div class="search-box">
                <input type="text" placeholder="Search documentation..." id="searchInput">
            </div>

            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">GETTING STARTED</div>
                    <a href="../index.html" class="nav-item">
                        <span class="nav-icon">üè†</span>
                        <span>Overview</span>
                    </a>
                    <a href="architecture.html" class="nav-item">
                        <span class="nav-icon">üèõÔ∏è</span>
                        <span>Architecture</span>
                    </a>
                    <a href="network-params.html" class="nav-item">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>Network Parameters</span>
                    </a>
                    <a href="building.html" class="nav-item">
                        <span class="nav-icon">üî®</span>
                        <span>Building & Setup</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">CORE BLOCKCHAIN</div>
                    <a href="blockchain-core.html" class="nav-item">
                        <span class="nav-icon">‚õìÔ∏è</span>
                        <span>Block & Transaction</span>
                    </a>
                    <a href="utxo-model.html" class="nav-item">
                        <span class="nav-icon">üíé</span>
                        <span>UTXO Model</span>
                    </a>
                    <a href="consensus.html" class="nav-item">
                        <span class="nav-icon">üîê</span>
                        <span>Consensus & PoW</span>
                    </a>
                    <a href="validation.html" class="nav-item">
                        <span class="nav-icon">‚úÖ</span>
                        <span>Validation System</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">CONTRIBUTION SYSTEM</div>
                    <a href="contribution-overview.html" class="nav-item">
                        <span class="nav-icon">üéØ</span>
                        <span>Contribution Overview</span>
                    </a>
                    <a href="contribution-types.html" class="nav-item">
                        <span class="nav-icon">üìã</span>
                        <span>Contribution Types</span>
                    </a>
                    <a href="contribution-rewards.html" class="nav-item">
                        <span class="nav-icon">üí∞</span>
                        <span>Reward System</span>
                    </a>
                    <a href="verification-system.html" class="nav-item">
                        <span class="nav-icon">üîç</span>
                        <span>Verification System</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">MWEB PRIVACY</div>
                    <a href="mweb-overview.html" class="nav-item">
                        <span class="nav-icon">üîí</span>
                        <span>MWEB Overview</span>
                    </a>
                    <a href="mweb-structures.html" class="nav-item">
                        <span class="nav-icon">üèóÔ∏è</span>
                        <span>MWEB Structures</span>
                    </a>
                    <a href="mweb-operations.html" class="nav-item active">
                        <span class="nav-icon">‚ö°</span>
                        <span>Peg-in/Peg-out</span>
                    </a>
                    <a href="mweb-mempool.html" class="nav-item">
                        <span class="nav-icon">üì¶</span>
                        <span>MWEB Mempool</span>
                    </a>
                    <a href="mweb-implementation-status.html" class="nav-item">
                        <span class="nav-icon">‚úÖ</span>
                        <span>Implementation Status</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">RPC API</div>
                    <a href="rpc-overview.html" class="nav-item">
                        <span class="nav-icon">üì°</span>
                        <span>RPC Overview</span>
                    </a>
                    <a href="rpc-contribution.html" class="nav-item">
                        <span class="nav-icon">üì§</span>
                        <span>Contribution RPC</span>
                    </a>
                    <a href="rpc-mweb.html" class="nav-item">
                        <span class="nav-icon">üîê</span>
                        <span>MWEB RPC</span>
                    </a>
                    <a href="rpc-mining.html" class="nav-item">
                        <span class="nav-icon">‚õèÔ∏è</span>
                        <span>Mining RPC</span>
                    </a>
                    <a href="rpc-wallet.html" class="nav-item">
                        <span class="nav-icon">üëõ</span>
                        <span>Wallet RPC</span>
                    </a>
                    <a href="rpc-blockchain.html" class="nav-item">
                        <span class="nav-icon">‚õìÔ∏è</span>
                        <span>Blockchain RPC</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">WALLET SYSTEM</div>
                    <a href="wallet-overview.html" class="nav-item">
                        <span class="nav-icon">üëõ</span>
                        <span>Wallet Overview</span>
                    </a>
                    <a href="wallet-classes.html" class="nav-item">
                        <span class="nav-icon">üì¶</span>
                        <span>Wallet Classes</span>
                    </a>
                    <a href="address-system.html" class="nav-item">
                        <span class="nav-icon">üìç</span>
                        <span>Address System</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">QT GUI</div>
                    <a href="qt-overview.html" class="nav-item">
                        <span class="nav-icon">üñ•Ô∏è</span>
                        <span>GUI Overview</span>
                    </a>
                    <a href="qt-components.html" class="nav-item">
                        <span class="nav-icon">üß©</span>
                        <span>Components</span>
                    </a>
                    <a href="qt-models.html" class="nav-item">
                        <span class="nav-icon">üìä</span>
                        <span>Models</span>
                    </a>
                    <a href="qt-themes.html" class="nav-item">
                        <span class="nav-icon">üé®</span>
                        <span>Themes</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">FEE STRUCTURE</div>
                    <a href="fee-system.html" class="nav-item">
                        <span class="nav-icon">üíµ</span>
                        <span>Fee System</span>
                    </a>
                    <a href="community-reserve.html" class="nav-item">
                        <span class="nav-icon">üè¶</span>
                        <span>Community Reserve</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">TESTING</div>
                    <a href="testing-overview.html" class="nav-item">
                        <span class="nav-icon">üß™</span>
                        <span>Testing Overview</span>
                    </a>
                    <a href="test-structures.html" class="nav-item">
                        <span class="nav-icon">üìù</span>
                        <span>Test Structures</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">REFERENCE</div>
                    <a href="erd-diagram.html" class="nav-item">
                        <span class="nav-icon">üìê</span>
                        <span>ERD Diagram</span>
                    </a>
                    <a href="naming-conventions.html" class="nav-item">
                        <span class="nav-icon">üìù</span>
                        <span>Naming Conventions</span>
                    </a>
                    <a href="api-reference.html" class="nav-item">
                        <span class="nav-icon">üìö</span>
                        <span>Complete API Reference</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h1>Peg-in/Peg-out</h1>
            </div>

            <section class="content-section">
                <h2>What are Peg-in and Peg-out?</h2>
                <p>MWEB transactions exist in a separate UTXO set from the main chain. To move FC between the main chain and MWEB, you use <strong>atomic swaps</strong> called peg-in and peg-out operations.</p>
                
                <div class="note">
                    <strong>Why Needed:</strong> MWEB uses a separate UTXO set for privacy. To use MWEB privacy features, you must first peg-in FC from the main chain. To return FC to the main chain (e.g., for exchanges), you peg-out.
                </div>
                
                <h3>Key Concepts</h3>
                <ul>
                    <li><strong>Atomic:</strong> Either both operations succeed or both fail (no partial states)</li>
                    <li><strong>One-Way:</strong> Peg-in moves FC from main ‚Üí MWEB, peg-out moves FC from MWEB ‚Üí main</li>
                    <li><strong>Verifiable:</strong> Both operations are cryptographically verifiable</li>
                </ul>
            </section>

            <section class="content-section">
                <h2>Peg-in (Main Chain ‚Üí MWEB)</h2>
                <p><strong>Purpose:</strong> Move FC from the main chain to MWEB to enable privacy features.</p>
                
                <h3>Step-by-Step Process</h3>
                <ol>
                    <li><strong>Create Main Chain Transaction:</strong> User creates a transaction locking funds to a peg-in address</li>
                    <li><strong>Broadcast to Main Chain:</strong> Transaction is included in a main chain block</li>
                    <li><strong>Wait for Confirmation:</strong> Wait for sufficient confirmations (typically 6-12 blocks)</li>
                    <li><strong>Create Peg-in Transaction:</strong> Peg-in transaction created in MWEB extension block</li>
                    <li><strong>Create MWEB Output:</strong> MWEB output created with commitment hiding the amount</li>
                    <li><strong>Verify:</strong> Network verifies peg-in matches main chain transaction</li>
                </ol>
                
                <h3>RPC Command</h3>
                <pre><code>fleetcredits-cli createpegin "mweb_address" 1000.0 "optional_comment"</code></pre>
                
                <h3>Response</h3>
                <pre><code>{
    "pegtxid": "abc123...",
    "maintxid": "def456...",
    "amount": 1000.0,
    "status": "pending"
}</code></pre>
                
                <h3>Technical Details</h3>
                <h4>Main Chain Transaction</h4>
                <p>The main chain transaction:</p>
                <ul>
                    <li>Locks funds to a special peg-in script</li>
                    <li>Contains amount (visible, for verification)</li>
                    <li>Includes recipient MWEB address</li>
                    <li>Has unique transaction ID</li>
                </ul>
                
                <h4>Peg-in Transaction Structure</h4>
                <pre><code>class CPegInTransaction {
    uint256 main_chain_tx_id;    // Links to main chain transaction
    CPubKey recipient_address;   // MWEB address receiving funds
    uint64_t amount;             // Amount in FC (visible for verification)
    uint256 peg_tx_id;          // Unique identifier
};</code></pre>
                
                <h4>MWEB Output Creation</h4>
                <p>When peg-in succeeds:</p>
                <ol>
                    <li>Pedersen commitment created: <code>C = vG + rH</code></li>
                    <li>Range proof generated: proves <code>0 ‚â§ amount < MAX_MONEY</code></li>
                    <li>MWEB output created with commitment and range proof</li>
                    <li>Output added to MWEB UTXO set</li>
                </ol>
                
                <h3>Example Use Case</h3>
                <p><strong>Scenario:</strong> Alice wants to submit an ETHICAL_REVIEW contribution privately.</p>
                <ol>
                    <li>Alice has 5000 FC on main chain</li>
                    <li>She calls <code>createpegin</code> to move 2000 FC to MWEB</li>
                    <li>Main chain transaction locks 2000 FC</li>
                    <li>After 6 confirmations, MWEB output created</li>
                    <li>Alice can now submit ETHICAL_REVIEW via MWEB</li>
                </ol>
                
                <h3>Security Considerations</h3>
                <ul>
                    <li><strong>Replay Prevention:</strong> Each peg-in has unique transaction ID</li>
                    <li><strong>Double-Spend Protection:</strong> Main chain transaction prevents double-spending</li>
                    <li><strong>Confirmation Wait:</strong> Waiting for confirmations prevents chain reorganization attacks</li>
                </ul>
            </section>

            <section class="content-section">
                <h2>Peg-out (MWEB ‚Üí Main Chain)</h2>
                <p><strong>Purpose:</strong> Move FC from MWEB back to the main chain (e.g., for exchanges or standard transactions).</p>
                
                <h3>Step-by-Step Process</h3>
                <ol>
                    <li><strong>Spend MWEB Output:</strong> User spends MWEB output (commitment)</li>
                    <li><strong>Generate View Key Proof:</strong> View key proof generated to prove amount</li>
                    <li><strong>Create Peg-out Transaction:</strong> Peg-out transaction created in MWEB extension block</li>
                    <li><strong>Create Main Chain Output:</strong> Main chain output created with revealed amount</li>
                    <li><strong>Verify:</strong> Network verifies view key proof and amount</li>
                    <li><strong>Confirm:</strong> Transaction confirmed on both chains</li>
                </ol>
                
                <h3>RPC Command</h3>
                <pre><code>fleetcredits-cli createpegout "commitment_hash" 500.0 "main_chain_address"</code></pre>
                
                <h3>Response</h3>
                <pre><code>{
    "pegtxid": "xyz789...",
    "amount": 500.0,
    "main_chain_address": "FC1ABC...",
    "status": "pending"
}</code></pre>
                
                <h3>Technical Details</h3>
                <h4>View Key Proof</h4>
                <p>The view key proof:</p>
                <ul>
                    <li>Proves the commitment contains a specific amount</li>
                    <li>Doesn't reveal other MWEB transactions</li>
                    <li>Allows verification without compromising privacy</li>
                    <li>Generated from the MWEB output's view key</li>
                </ul>
                
                <h4>Peg-out Transaction Structure</h4>
                <pre><code>class CPegOutTransaction {
    CPedersenCommitment mweb_input_commitment;  // MWEB output being spent
    CPubKey main_chain_address;                // Address receiving funds
    uint64_t amount;                           // Amount in FC (visible)
    std::vector<unsigned char> view_key;        // Proof of amount
    uint256 peg_tx_id;                         // Unique identifier
};</code></pre>
                
                <h4>Main Chain Output Creation</h4>
                <p>When peg-out succeeds:</p>
                <ol>
                    <li>View key proof verified</li>
                    <li>Amount revealed (must match proof)</li>
                    <li>Main chain output created</li>
                    <li>Output added to main chain UTXO set</li>
                </ol>
                
                <h3>Example Use Case</h3>
                <p><strong>Scenario:</strong> Bob wants to exchange MWEB FC for Bitcoin on a DEX.</p>
                <ol>
                    <li>Bob has 1500 FC in MWEB (hidden amount)</li>
                    <li>He calls <code>createpegout</code> to move 1000 FC to main chain</li>
                    <li>View key proof generated proving amount</li>
                    <li>Main chain output created with 1000 FC</li>
                    <li>Bob can now swap FC for Bitcoin on DEX</li>
                </ol>
                
                <h3>Security Considerations</h3>
                <ul>
                    <li><strong>View Key Security:</strong> View key must be kept secure</li>
                    <li><strong>Proof Verification:</strong> Network verifies view key proof</li>
                    <li><strong>Amount Verification:</strong> Revealed amount must match proof</li>
                    <li><strong>Privacy Protection:</strong> Other MWEB transactions remain hidden</li>
                </ul>
            </section>

            <section class="content-section">
                <h2>Atomic Swap Mechanism</h2>
                <p>Peg-in and peg-out use <strong>atomic swaps</strong> to ensure both operations succeed or fail together.</p>
                
                <h3>How Atomicity Works</h3>
                <h4>Peg-in Atomicity</h4>
                <ol>
                    <li>Main chain transaction locks funds</li>
                    <li>If main chain transaction fails, no MWEB output created</li>
                    <li>If main chain transaction succeeds, MWEB output guaranteed</li>
                    <li>Both operations are atomic (all-or-nothing)</li>
                </ol>
                
                <h4>Peg-out Atomicity</h4>
                <ol>
                    <li>MWEB output spent (commitment consumed)</li>
                    <li>If view key proof invalid, peg-out fails</li>
                    <li>If view key proof valid, main chain output guaranteed</li>
                    <li>Both operations are atomic (all-or-nothing)</li>
                </ol>
                
                <h3>Why Atomicity Matters</h3>
                <ul>
                    <li><strong>Prevents Partial States:</strong> No risk of funds being stuck</li>
                    <li><strong>Security:</strong> Either both operations succeed or neither does</li>
                    <li><strong>Reliability:</strong> Users don't lose funds due to failures</li>
                </ul>
            </section>

            <section class="content-section">
                <h2>Fees and Costs</h2>
                
                <h3>Peg-in Fees</h3>
                <ul>
                    <li><strong>Main Chain Fee:</strong> Standard transaction fee (zero for micro-transactions)</li>
                    <li><strong>MWEB Fee:</strong> Zero fee for MWEB output creation</li>
                    <li><strong>Total Cost:</strong> Only main chain transaction fee</li>
                </ul>
                
                <h3>Peg-out Fees</h3>
                <ul>
                    <li><strong>MWEB Fee:</strong> Zero fee for MWEB transaction</li>
                    <li><strong>Main Chain Fee:</strong> Standard transaction fee (zero for micro-transactions)</li>
                    <li><strong>Total Cost:</strong> Only main chain transaction fee</li>
                </ul>
                
                <h3>Cost Comparison</h3>
                <table>
                    <tr><th>Operation</th><th>Main Chain Fee</th><th>MWEB Fee</th><th>Total</th></tr>
                    <tr><td>Peg-in (<1000 FC)</td><td>0 FC</td><td>0 FC</td><td><strong>0 FC</strong></td></tr>
                    <tr><td>Peg-in (‚â•1000 FC)</td><td>0.2 FC/kB</td><td>0 FC</td><td><strong>0.2 FC/kB</strong></td></tr>
                    <tr><td>Peg-out (<1000 FC)</td><td>0 FC</td><td>0 FC</td><td><strong>0 FC</strong></td></tr>
                    <tr><td>Peg-out (‚â•1000 FC)</td><td>0.2 FC/kB</td><td>0 FC</td><td><strong>0.2 FC/kB</strong></td></tr>
                </table>
            </section>

            <section class="content-section">
                <h2>Common Workflows</h2>
                
                <h3>Workflow 1: Privacy for Ethical Review</h3>
                <ol>
                    <li>Peg-in 2000 FC from main chain to MWEB</li>
                    <li>Submit ETHICAL_REVIEW contribution via MWEB</li>
                    <li>Receive reward in MWEB (hidden amount)</li>
                    <li>Continue using MWEB for privacy or peg-out when needed</li>
                </ol>
                
                <h3>Workflow 2: Private Donation</h3>
                <ol>
                    <li>Peg-in donation amount to MWEB</li>
                    <li>Send MWEB transaction to charity</li>
                    <li>Charity receives MWEB output (hidden amount)</li>
                    <li>Charity can peg-out or keep in MWEB</li>
                </ol>
                
                <h3>Workflow 3: Exchange Integration</h3>
                <ol>
                    <li>Receive FC on main chain from exchange</li>
                    <li>Peg-in to MWEB for privacy</li>
                    <li>Use MWEB for private transactions</li>
                    <li>Peg-out when need to send back to exchange</li>
                </ol>
            </section>

            <section class="content-section">
                <h2>Best Practices</h2>
                
                <h3>When to Peg-in</h3>
                <ul>
                    <li>Need privacy for sensitive contributions (ETHICAL_REVIEW)</li>
                    <li>Want to hide transaction amounts</li>
                    <li>Preparing for multiple private transactions</li>
                    <li>Protecting recipient privacy</li>
                </ul>
                
                <h3>When to Peg-out</h3>
                <ul>
                    <li>Need to send FC to exchange</li>
                    <li>Interacting with services that don't support MWEB</li>
                    <li>Want to use standard wallet features</li>
                    <li>No longer need privacy</li>
                </ul>
                
                <h3>Optimization Tips</h3>
                <ul>
                    <li><strong>Batch Peg-ins:</strong> Peg-in larger amounts to reduce transaction count</li>
                    <li><strong>Use MWEB for Multiple Transactions:</strong> Avoid frequent peg-in/peg-out</li>
                    <li><strong>Monitor Confirmation Times:</strong> Peg-in requires main chain confirmations</li>
                    <li><strong>Keep View Keys Secure:</strong> Required for peg-out verification</li>
                </ul>
            </section>

            <section class="content-section">
                <h2>Related Documentation</h2>
                <ul>
                    <li><a href="mweb-overview.html">MWEB Overview</a> - High-level MWEB concepts</li>
                    <li><a href="mweb-structures.html">MWEB Structures</a> - Data structures for peg-in/peg-out</li>
                    <li><a href="rpc-mweb.html">MWEB RPC</a> - API for <code>createpegin</code> and <code>createpegout</code></li>
                    <li><a href="contribution-types.html">Contribution Types</a> - How contributions use MWEB</li>
                </ul>
            </section>
        </main>
    </div>

    <script src="../assets/js/main.js"></script>
</body>
</html>